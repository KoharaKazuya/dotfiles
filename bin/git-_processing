#!/bin/zsh
#
# 任意コマンドの出力をパイプで置換するため、終了ステータスが取れない
# zsh 拡張の $pipestatus を利用するため、zsh を指定する

set -eu

# 引数は 3 つ以上必須
[ "$#" -ge 3 ]

# タグ表示
# 例: [cc ]
printf -- '%3s: ' "$1"
shift

# 処理中メッセージ表示
# 例: Merging...
printf -- "$1...\n"
shift

env GIT_PAGER_IN_USE=true sh -c "$*" 2>&1 | sed -E 's/^/   | /'
if [ $pipestatus[2] = 0 ]; then
  printf '   | \e[1;32m✓\e[0m\n\n'
else
  printf '   | \e[1;31m✓\e[0m\n\n'
  exit 1
fi
