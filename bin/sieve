#!/bin/sh

set -eu

usage() {
    cat <<HELP
NAME:
  $(basename $0) -- {one sentence description}

SYNOPSIS:
  $(basename $0) [-h|--help]
  $(basename $0) [--verbose]

DESCRIPTION:
  {description here}

  -h  --help      Print this help.
      --verbose   Enables verbose mode.
  -p  --placeholder          入力行で置き換える文字列

EXAMPLE:
  {examples if any}

HELP
}

# 割り込みや正常終了時に実行する処理
graceful_exit() {
  :
}
trap graceful_exit 0

opt_arg=""
parse_opt_arg() {
    # 引数が必要なオプションに引数がなければエラー終了させる
    if [ $# -lt 2 ] || !(case "$2" in -*) false;; esac); then
        printf "Option requires an argument: $1\n" >&2
        exit 1
    fi

    opt_arg="$2"
}


script_dir="$(cd $(dirname "$0"); pwd)"
placeholder='{}'

while [ $# -gt 0 ]; do
    case "$1" in
        -p | --placeholder         ) parse_opt_arg "$@"
                                     placeholder="$opt_arg"
                                     shift;;
        -h | --help    ) usage; exit 0;;
             --verbose ) set -x;;
        --             ) shift; break;;
        -*             ) printf "Illegal option: $1\n" >&2; exit 1;;
        *              ) break;;
    esac
    shift
done


cat - | xargs -I"$placeholder" sh -c "if $* >/dev/null; then echo '$placeholder'; fi"
